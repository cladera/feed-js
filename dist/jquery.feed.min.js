/*! jquery.feed 2013-11-28 */
!function(a){var b=function(b,c){var d=this;this.context=c,this.options=b,this.running=!1,this.lastCommentId=0,this.comments=[],"object"==typeof this.options.source?a.each(this.options.source,function(a,b){d.add(b)}):"string"==typeof this.options.source?this.options.auto&&d.start():console.error("Invalid source type"),this.context.addClass("feed")};b.prototype.add=function(b){var c=a('<div class="comment"></div>');return c.append('<div class="author"><span class="name">'+b.author.name+'</span> <span class="email">&#60'+b.author.email+"&#62</span></div>"),c.append('<div class="datetime">'+this.options.renderDate.call(this,b.datetime)+"</div>"),c.append('<div class="body">'+b.body||"</div>"),c.hide(),this.context.prepend(c),c.fadeIn("slow"),b.context=c,this.comments.push(b),b.id>this.lastCommentId&&(this.lastCommentId=b.id),this},b.prototype.refreshDates=function(){var b=this;a.each(b.comments,function(a,c){c.context.find(".datetime").html(b.options.renderDate.call(b,c.datetime))})},b.prototype.refresh=function(){this._get()},b.prototype.stop=function(){this.running=!1},b.prototype.start=function(){this.running!==!0&&(this.running=!0,this._get())},b.prototype._get=function(){if("string"==typeof this.options.source){var b=this;a.ajax({url:b.options.source,dataType:"json",data:b.options.idFilter+"="+b.lastCommentId}).done(function(c){c.length>0&&a.each(c,function(a,c){b.add(c)}),b.refreshDates(),b.running&&b.options.refreshDelay>0&&setTimeout(function(){b.running&&b._get()},1e3*b.options.refreshDelay)}).error(function(){b.context.trigger("error"),!b.options.haltOnError&&b.running&&b.options.refreshDelay>0&&setTimeout(function(){b.running&&b._get()},1e3*b.options.refreshDelay)})}},a.widget("ui.feed",{options:{renderDate:function(a){return a},auto:!1,refreshDelay:0,source:[],idFilter:"since",haltOnError:!0},_create:function(){this.feed=new b(this.options,this.element)},destroy:function(){},_setOption:function(a){},add:function(a){this.feed.add(a)},refresh:function(){this.feed.refresh()},start:function(){this.feed.start()},stop:function(){this.feed.stop()}})}(jQuery);